<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Posts & Photos - <%= @persona.name.titleize %></h1>
    
    <!-- Strategy Suggestion Button -->
    <%= form_with url: suggest_next_persona_scheduling_posts_path(@persona), method: :post, class: "inline" do |f| %>
      <%= f.submit "üéØ Get Next Post Suggestion",
                   class: "px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors font-medium" %>
    <% end %>
  </div>

  <!-- Available Photos -->
  <% if @photos.any? %>
    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-4 text-cyan-400">üì∏ Available Photos (<%= @photos.count %>)</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <% @photos.each do |photo| %>
          <%= render CardComponent.new(classes: "hover:shadow-lg transition-shadow") do |c| %>
            <% c.with_body do %>
              <!-- Photo Preview -->
              <% if photo.image.attached? %>
                <%= image_tag photo.image, 
                             class: "w-full h-64 object-cover rounded-t-lg mb-4" %>
              <% end %>
              
              <!-- Photo Info -->
              <div class="space-y-2 mb-4">
                <% if photo.content_pillar %>
                  <div class="text-sm">
                    <span class="font-semibold">Pillar:</span>
                    <span class="text-zinc-400"><%= photo.content_pillar.name %></span>
                  </div>
                <% end %>
                
                <div class="text-sm text-zinc-500">
                  Created <%= time_ago_in_words(photo.created_at) %> ago
                </div>
              </div>
              
              <!-- Create Post Button -->
              <%= link_to "Create Post", 
                         new_persona_scheduling_post_path(@persona, photo_id: photo.id),
                         class: "block w-full text-center px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors" %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Scheduled Posts -->
  <% if @scheduled_posts.any? %>
    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-4 text-blue-400">üìÖ Scheduled (<%= @scheduled_posts.count %>)</h2>
      <div class="space-y-4">
        <% @scheduled_posts.each do |post| %>
          <%= render CardComponent.new do |c| %>
            <% c.with_body do %>
              <div class="flex gap-4">
                <!-- Photo Preview -->
                <% if post.photo&.image&.attached? %>
                  <div class="flex-shrink-0">
                    <%= image_tag post.photo.image, 
                                 class: "w-32 h-32 object-cover rounded-lg" %>
                  </div>
                <% elsif post.photo %>
                  <div class="flex-shrink-0 w-32 h-32 bg-red-900/40 border-2 border-red-700 rounded-lg flex items-center justify-center">
                    <span class="text-red-400 text-xs text-center px-2">‚ö†Ô∏è Missing Image</span>
                  </div>
                <% else %>
                  <div class="flex-shrink-0 w-32 h-32 bg-zinc-800 rounded-lg flex items-center justify-center">
                    <span class="text-zinc-600">No Photo</span>
                  </div>
                <% end %>
                
                <!-- Post Details -->
                <div class="flex-1">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <div class="text-sm text-zinc-400">
                        <%= post.scheduled_at.strftime('%b %d, %Y at %I:%M %p') %>
                      </div>
                      <% if post.photo&.content_pillar %>
                        <div class="text-xs text-zinc-500">
                          <%= post.photo.content_pillar.name %>
                        </div>
                      <% end %>
                      <% if post.photo && !post.photo.image.attached? %>
                        <div class="text-xs text-red-400 mt-1">
                          ‚ö†Ô∏è Photo file missing or not attached
                        </div>
                      <% end %>
                    </div>
                    <span class="px-2 py-1 text-xs rounded bg-blue-900/40 text-blue-300">
                      <%= post.status.titleize %>
                    </span>
                  </div>
                  
                  <p class="text-zinc-300 text-sm mb-2">
                    <%= truncate(post.caption, length: 150) %>
                  </p>
                  
                  <% if post.hashtags.present? %>
                    <div class="text-xs text-zinc-500 mb-2">
                      <%= post.hashtags.map { |tag| "##{tag}" }.join(' ') %>
                    </div>
                  <% end %>
                  
                  <%= button_to "üóëÔ∏è Delete", 
                               persona_scheduling_post_path(@persona, post),
                               method: :delete,
                               data: { turbo_confirm: "Are you sure you want to delete this post?" },
                               class: "text-xs text-red-400 hover:text-red-300" %>
                </div>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Draft Posts (Awaiting Images) -->
  <% if @draft_posts.any? %>
    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-4 text-yellow-400">üìù Drafts (<%= @draft_posts.count %>)</h2>
      <div class="space-y-4">
        <% @draft_posts.each do |post| %>
          <%= render CardComponent.new do |c| %>
            <% c.with_body do %>
              <div class="flex gap-4">
                <!-- Placeholder -->
                <div class="flex-shrink-0 w-32 h-32 bg-zinc-800 rounded-lg flex items-center justify-center">
                  <span class="text-zinc-600">‚è≥ Awaiting Image</span>
                </div>
                
                <!-- Post Details -->
                <div class="flex-1">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <div class="text-sm text-zinc-400">
                        Scheduled: <%= post.scheduled_at&.strftime('%b %d, %Y at %I:%M %p') || 'Not scheduled' %>
                      </div>
                      <% if post.content_suggestion %>
                        <div class="text-xs text-purple-400">
                          ü§ñ From LLM Campaign: <%= post.content_suggestion.title %>
                        </div>
                      <% end %>
                    </div>
                    <span class="px-2 py-1 text-xs rounded bg-yellow-900/40 text-yellow-300">
                      Draft - Needs Image
                    </span>
                  </div>
                  
                  <p class="text-zinc-300 text-sm mb-2">
                    <%= truncate(post.caption, length: 150) %>
                  </p>
                  
                  <div class="flex gap-3 items-center">
                    <% if post.content_suggestion %>
                      <%= link_to "üé® Generate Image", 
                                 generate_image_content_suggestion_path(post.content_suggestion),
                                 method: :post,
                                 class: "text-sm text-purple-400 hover:text-purple-300" %>
                    <% end %>
                    
                    <%= button_to "üóëÔ∏è Delete", 
                                 persona_scheduling_post_path(@persona, post),
                                 method: :delete,
                                 data: { turbo_confirm: "Are you sure you want to delete this draft post?" },
                                 class: "text-xs text-red-400 hover:text-red-300" %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Recently Posted -->
  <% if @posted_posts.any? %>
    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-4 text-green-400">‚úÖ Posted (<%= @posted_posts.count %>)</h2>
      <div class="space-y-4">
        <% @posted_posts.each do |post| %>
          <%= render CardComponent.new do |c| %>
            <% c.with_body do %>
              <div class="flex gap-4">
                <!-- Photo Preview -->
                <% if post.photo&.image&.attached? %>
                  <div class="flex-shrink-0">
                    <%= image_tag post.photo.image, 
                                 class: "w-32 h-32 object-cover rounded-lg" %>
                  </div>
                <% end %>
                
                <!-- Post Details -->
                <div class="flex-1">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <div class="text-sm text-green-400">
                        Posted <%= time_ago_in_words(post.updated_at) %> ago
                      </div>
                    </div>
                    <span class="px-2 py-1 text-xs rounded bg-green-900/40 text-green-300">
                      Posted
                    </span>
                  </div>
                  
                  <p class="text-zinc-300 text-sm mb-2">
                    <%= truncate(post.caption, length: 150) %>
                  </p>
                  
                  <%= button_to "üóëÔ∏è Delete", 
                               persona_scheduling_post_path(@persona, post),
                               method: :delete,
                               data: { turbo_confirm: "Are you sure you want to delete this posted record?" },
                               class: "text-xs text-red-400 hover:text-red-300" %>
                </div>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Empty State -->
  <% if @scheduled_posts.empty? && @draft_posts.empty? && @posted_posts.empty? %>
    <%= render CardComponent.new do |c| %>
      <% c.with_body do %>
        <div class="text-center py-12">
          <p class="text-zinc-400 mb-4 text-lg">No posts yet!</p>
          <p class="text-zinc-500 mb-6">Click "Get Next Post Suggestion" above to create your first scheduled post.</p>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>
