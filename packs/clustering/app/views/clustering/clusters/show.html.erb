<!DOCTYPE html>
<html>
  <head>
    <title><%= @cluster.name %> - Cluster</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-gray-900 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <!-- Header with Breadcrumbs -->
      <div class="mb-6 text-sm text-gray-400">
        <%= link_to "Personas", personas_path, class: "hover:text-gray-200" %> â†’
        <%= link_to @persona.name.titleize, persona_path(@persona), class: "hover:text-gray-200" %> â†’
        <%= link_to @pillar.name, persona_pillar_path(@persona, @pillar), class: "hover:text-gray-200" %> â†’
        <span class="text-white"><%= @cluster.name %></span>
      </div>

      <!-- Cluster Header -->
      <div class="flex justify-between items-start mb-8">
        <div>
          <h1 class="text-3xl font-bold text-white mb-2">
            ðŸŽ¯ <%= @cluster.name %>
          </h1>
          <p class="text-gray-400">
            Status: <span class="px-2 py-1 bg-blue-600 rounded text-white text-sm"><%= @cluster.status.titleize %></span>
          </p>
        </div>

        <div class="flex gap-3">
          <%= link_to "â† Back to Pillar", persona_pillar_path(@persona, @pillar), class: "px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600" %>
          <%= link_to "+ New Run", new_run_path(cluster_id: @cluster.id, persona_id: @persona.id), class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" %>
        </div>
      </div>

      <!-- Cluster Details -->
      <% if @cluster.ai_prompt.present? %>
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
          <h2 class="text-lg font-semibold text-white mb-3">AI Prompt</h2>
          <p class="text-gray-300 whitespace-pre-wrap"><%= @cluster.ai_prompt %></p>
        </div>
      <% end %>

      <!-- Runs List -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-semibold text-white mb-4">
          Pipeline Runs
          <span class="text-sm text-gray-400 font-normal">(<%= @runs.count %>)</span>
        </h2>

        <% if @runs.any? %>
          <div class="space-y-3">
            <% @runs.each do |run| %>
              <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-650 transition">
                <%= link_to run_path(run), class: "block" do %>
                  <div class="flex justify-between items-start">
                    <div class="flex-1">
                      <h3 class="text-white font-medium mb-1"><%= run.name %></h3>
                      <div class="text-sm text-gray-400">
                        <span>Pipeline: <%= run.pipeline.name %></span>
                        <% if run.prompt.present? %>
                          <span class="ml-3">Prompt: <%= run.prompt.truncate(50) %></span>
                        <% end %>
                      </div>
                      <div class="text-xs text-gray-500 mt-1">
                        Created <%= time_ago_in_words(run.created_at) %> ago
                      </div>
                    </div>
                    <div class="ml-4">
                      <span class="px-3 py-1 bg-blue-600 rounded text-white text-sm">
                        <%= run.status.titleize %>
                      </span>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-12">
            <p class="text-gray-400 mb-4">No pipeline runs yet</p>
            <%= link_to "+ Create First Run", new_run_path(cluster_id: @cluster.id, persona_id: @persona.id), class: "inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700" %>
          </div>
        <% end %>
      </div>
    </div>
  </body>
</html>
