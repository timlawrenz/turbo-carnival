<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-2"><%= @persona.name.titleize %></h1>
  <p class="text-zinc-600 mb-8">Persona Dashboard</p>
  
  <!-- Actions -->
  <div class="mb-8 flex gap-4 flex-wrap">
    <%= button_to "üéØ Get Next Post Suggestion", suggest_next_persona_scheduling_posts_path(@persona), method: :post,
                  class: "bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2 rounded" %>
    <%= link_to "Browse All Photos", persona_scheduling_posts_path(@persona),
                class: "bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded inline-block" %>
    <%= link_to "Show Content Suggestions", persona_content_suggestions_path(@persona),
                class: "bg-purple-600 hover:bg-purple-700 text-white font-medium px-6 py-2 rounded inline-block" %>
    <%= link_to "ü§ñ LLM Campaigns", persona_campaigns_path(@persona),
                class: "bg-purple-500 hover:bg-purple-600 text-white font-medium px-6 py-2 rounded inline-block border border-purple-400" %>
    <%= link_to "View Runs", runs_path, 
                class: "bg-zinc-600 hover:bg-zinc-700 text-white font-medium px-6 py-2 rounded inline-block" %>
  </div>
  
  <!-- Stats -->
  <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
    <%= render CardComponent.new do |c| %>
      <% c.with_body do %>
        <div class="text-2xl font-bold"><%= @pillars.count %></div>
        <div class="text-zinc-400">Pillars</div>
      <% end %>
    <% end %>
    <%= render CardComponent.new do |c| %>
      <% c.with_body do %>
        <div class="text-2xl font-bold"><%= @total_photos %></div>
        <div class="text-zinc-400">Total Photos</div>
      <% end %>
    <% end %>
    <%= render CardComponent.new do |c| %>
      <% c.with_body do %>
        <div class="text-2xl font-bold text-green-400"><%= @unposted_photos %></div>
        <div class="text-zinc-400">Available</div>
      <% end %>
    <% end %>
    <%= render CardComponent.new do |c| %>
      <% c.with_body do %>
        <div class="text-2xl font-bold text-blue-400"><%= @scheduled_posts %></div>
        <div class="text-zinc-400">Scheduled</div>
      <% end %>
    <% end %>
    <%= render CardComponent.new do |c| %>
      <% c.with_body do %>
        <div class="text-2xl font-bold text-purple-400"><%= @posted_count %></div>
        <div class="text-zinc-400">Posted</div>
      <% end %>
    <% end %>
  </div>

  <!-- Upcoming Scheduled Posts -->
  <% if @upcoming_posts.any? %>
    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">üìÖ Upcoming Scheduled Posts</h2>
      <div class="space-y-3">
        <% @upcoming_posts.each do |post| %>
          <%= render CardComponent.new(classes: "border-l-4 border-blue-500") do |c| %>
            <% c.with_body do %>
              <div class="flex gap-4 items-start">
                <% if post.photo&.image&.attached? %>
                  <%= image_tag post.photo.image, class: "rounded w-20 h-20 object-cover" %>
                <% else %>
                  <div class="w-20 h-20 bg-zinc-700 rounded flex items-center justify-center text-zinc-500">
                    üì∑
                  </div>
                <% end %>
                
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="font-semibold text-lg">
                      <%= post.scheduled_at.strftime('%b %d at %I:%M %p') %>
                    </span>
                    <span class="text-xs text-zinc-500">
                      (<%= distance_of_time_in_words_to_now(post.scheduled_at) %> from now)
                    </span>
                  </div>
                  
                  <% if post.photo&.content_pillar %>
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-900/40 text-purple-300 border border-purple-700 mb-2">
                      <%= post.photo.content_pillar.name %>
                    </span>
                  <% end %>
                  
                  <p class="text-sm text-zinc-300 line-clamp-2">
                    <%= post.caption.truncate(120) %>
                  </p>
                  
                  <div class="flex items-center gap-2 mt-2 text-xs text-zinc-500">
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium 
                      <%= post.status == 'scheduled' ? 'bg-blue-900/40 text-blue-300' : 'bg-zinc-700 text-zinc-300' %>">
                      <%= post.status.titleize %>
                    </span>
                    <% if post.photo_id %>
                      <span>Photo #<%= post.photo_id %></span>
                    <% else %>
                      <span class="text-yellow-500">‚ö†Ô∏è No photo attached</span>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
      
      <% if @scheduled_posts > @upcoming_posts.count %>
        <div class="mt-4 text-center">
          <%= link_to "View All #{@scheduled_posts} Scheduled Posts ‚Üí", persona_scheduling_posts_path(@persona),
                      class: "text-blue-400 hover:text-blue-300 text-sm" %>
        </div>
      <% end %>
    </div>
  <% end %>

  <!-- Pillars List -->
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold">Content Pillars</h2>
    <%= link_to "‚ûï Add Pillar", new_persona_pillar_path(@persona), 
               class: "bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded inline-block" %>
  </div>
  
  <!-- Weight Summary -->
  <% if @pillars.active.any? %>
    <% total_weight = @pillars.active.sum(:weight) %>
    <%= render CardComponent.new(classes: "mb-4 #{total_weight == 100 ? 'border-green-700' : 'border-yellow-600'}") do |c| %>
      <% c.with_body do %>
        <div class="flex justify-between items-center">
          <span class="text-sm font-medium">Total Weight Allocation:</span>
          <span class="font-mono text-lg <%= total_weight == 100 ? 'text-green-400' : 'text-yellow-400' %>">
            <%= total_weight %>%
          </span>
        </div>
        <% if total_weight != 100 %>
          <p class="text-sm text-yellow-400 mt-2">
            ‚ö†Ô∏è Total should equal 100%. <%= total_weight > 100 ? 'Over' : 'Under' %> by <%= (total_weight - 100).abs %>%
          </p>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <div class="space-y-3">
    <% @pillars.each do |pillar| %>
      <%= render CardComponent.new(classes: "hover:bg-zinc-700 transition #{pillar.expired? ? 'opacity-50' : ''}") do |c| %>
        <% c.with_body do %>
          <%= link_to persona_pillar_path(@persona, pillar), class: "flex justify-between items-center" do %>
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <h3 class="font-semibold text-lg"><%= pillar.name %></h3>
                <% unless pillar.active? %>
                  <span class="text-xs bg-zinc-700 text-zinc-400 px-2 py-0.5 rounded">Inactive</span>
                <% end %>
                <% if pillar.expired? %>
                  <span class="text-xs bg-red-900/50 text-red-400 px-2 py-0.5 rounded">Expired</span>
                <% end %>
                <% if pillar.start_date || pillar.end_date %>
                  <span class="text-xs bg-blue-900/50 text-blue-400 px-2 py-0.5 rounded">
                    <% if pillar.start_date && pillar.end_date %>
                      <%= pillar.start_date.strftime('%m/%d') %> - <%= pillar.end_date.strftime('%m/%d/%y') %>
                    <% elsif pillar.start_date %>
                      From <%= pillar.start_date.strftime('%m/%d/%y') %>
                    <% else %>
                      Until <%= pillar.end_date.strftime('%m/%d/%y') %>
                    <% end %>
                  </span>
                <% end %>
              </div>
              <% if pillar.description.present? %>
                <p class="text-zinc-400 text-sm"><%= pillar.description %></p>
              <% end %>
              <div class="text-xs text-zinc-500 mt-1">
                Weight: <%= pillar.weight %>% | Priority: <%= pillar.priority %>
              </div>
            </div>
            <div class="text-zinc-400">
              <%= pluralize(pillar.photos.count, 'photo') %> ‚Üí
            </div>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
